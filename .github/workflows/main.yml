name: Stable-Tailscale-RDP
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Tailscale Install & Connect
        shell: powershell
        run: |
          # Tailscale install karna
          iwr -useb https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe -OutFile tailscale-setup.exe
          start-process -FilePath .\tailscale-setup.exe -ArgumentList "/quiet", "/norestart" -Wait
          
          # Tailscale connect karna (Apni AUTH KEY yahan dalen)
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey=YOUR_TAILSCALE_AUTH_KEY
          
      - name: Optimize Windows for Performance
        shell: powershell
        run: |
          # Connection stability ke liye Firewall aur Sleep settings fix karna
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "UserAuthentication" -Value 1
          # Screen timeout aur power saving off karna taake connection na toote
          powercfg /x -hibernate-timeout-ac 0
          powercfg /x -idle-timeout-ac 0

      - name: Keep RDP Alive (Loop)
        shell: powershell
        run: |
          $limit = 360 # 6 ghante ka limit
          for ($i = 1; $i -le $limit; $i++) {
              $time = Get-Date -Format "HH:mm:ss"
              Write-Host "[$time] RDP is Active and Stable... (Minute $i)"
              # CPU ko thora active rakhna taake GitHub idle samajh kar band na kare
              Add-Content -Path "alive.txt" -Value "Running"
              Start-Sleep -Seconds 60
          }
