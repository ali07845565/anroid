name: TITAN-V217-FREE-LEGEND-SETUP

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1. Setup User & Mobile View
        shell: powershell
        run: |
          $Password = ConvertTo-SecureString "Admin@Watch786" -AsPlainText -Force
          net user RDP Admin@Watch786 /add /expires:never
          net localgroup Administrators RDP /add
          # Mobile friendly resolution
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "DefaultDestinationHeight" -Value 600
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "DefaultDestinationWidth" -Value 800
          net start audiosrv 2>$null
          exit 0

      - name: 2. Install Chrome & Epic/BAS Dependencies
        shell: powershell
        run: |
          choco install googlechrome cloudflared python vcredist140 -y --no-progress
          pip install pyautogui requests --quiet

      - name: 3. Download Free Automation Tools
        shell: powershell
        run: |
          # 1. Epic Bot (Free Version Setup)
          Invoke-WebRequest -Uri "https://cdn.epicbot.com/EpicBotSetup.exe" -OutFile "C:\Users\Public\Desktop\EpicBot_Free.exe"
          # 2. BAS (Full Free Automation)
          Invoke-WebRequest -Uri "https://bablosoft.com/distr/BrowserAutomationStudio/BrowserAutomationStudioInstall.exe" -OutFile "C:\Users\Public\Desktop\BAS_Full_Free.exe"
          # 3. Fresh Proxy List
          $proxyPy = "import requests`nr = requests.get('https://api.proxyscrape.com/v2/?request=displayproxies&protocol=http')`nwith open('C:\\Users\\Public\\Desktop\\Proxies_List.txt', 'w') as f: f.write(r.text)"
          python -c "$proxyPy"

      - name: 4. Create "No-Drop" Auto-Search Script
        shell: powershell
        run: |
          $bot = @"
          import os, time, pyautogui
          # ISMEIN APNA LINK DALEIN RDP KE ANDAR
          def start_watchtime():
              for i in range(1, 51):
                  profile = f"C:\\Users\\Public\\Profile{i}"
                  # Ghost mode settings
                  os.system(f'start chrome --user-data-dir="{profile}" --mute-audio --disable-gpu "https://www.youtube.com"')
                  time.sleep(3)
          if __name__ == "__main__":
              start_watchtime()
              while True:
                  pyautogui.press('shift')
                  time.sleep(30)
          "@
          $bot | Out-File -FilePath "C:\Users\Public\Desktop\PYTHON_WATCH_BOT.py" -Encoding ascii

      - name: 5. Generate Direct Connection Link
        shell: powershell
        run: |
          Write-Host "--- COPY THIS LINK FOR MOBILE RDP ---" -ForegroundColor Cyan
          Start-Process cloudflared -ArgumentList "tunnel --url rdp://localhost:3389" -RedirectStandardOutput "C:\Users\Public\Desktop\address.log"
          Start-Sleep -Seconds 45
          $link = Get-Content "C:\Users\Public\Desktop\address.log" | Select-String "trycloudflare.com"
          Write-Host "YOUR LINK: $link" -ForegroundColor Green

      - name: 6. 9-Hour Non-Stop Power
        run: Start-Sleep -Seconds 32400
