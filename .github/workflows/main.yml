name: TITAN-V196-STREAM-ANTI-SLEEP

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1. Setup User & Audio
        continue-on-error: true
        shell: powershell
        run: |
          net user RDP Admin@Watch786 /add /expires:never
          net localgroup Administrators RDP /add
          net start audiosrv
          net start AudioEndpointBuilder

      - name: 2. Install Tools & Python Libraries
        continue-on-error: true
        shell: powershell
        run: |
          choco install obs-studio cloudflare-warp -y --no-progress
          pip install pyautogui --quiet
          winget install --id Mozilla.Firefox -e --silent --accept-source-agreements

      - name: 3. Tailscale Connect
        shell: powershell
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --accept-dns=false --force-reauth
          Start-Sleep -Seconds 30

      - name: 4. Deploy Anti-Sleep Bot & Shortcuts
        shell: powershell
        run: |
          # Anti-Sleep Mouse Bot Script
          $bot = @"
          import pyautogui
          import time
          import random

          print("TITAN ANTI-SLEEP BOT ACTIVE...")
          while True:
              x = random.randint(100, 500)
              y = random.randint(100, 500)
              pyautogui.moveTo(x, y, duration=0.5)
              time.sleep(30) # Har 30 sec baad mouse hilega
          "@
          $bot | Out-File -FilePath "C:\Users\Public\Desktop\ANTI_SLEEP.py" -Encoding ascii

          # Launchers
          "@echo off`npython C:\Users\Public\Desktop\ANTI_SLEEP.py" | Out-File -FilePath "C:\Users\Public\Desktop\RUN_ANTI_SLEEP.bat" -Encoding ascii
          "@echo off`nstart firefox `"https://tamashaweb.com/livetv/ten-sports-live`"" | Out-File -FilePath "C:\Users\Public\Desktop\Tamasha_Live.bat" -Encoding ascii

      - name: 5. Keep-Alive
        run: Start-Sleep -Seconds 32400
