name: Stable-Tailscale-RDP-Fixed
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Tailscale Install
        shell: powershell
        run: |
          Write-Host "üì• Tailscale download ho raha hai..."
          iwr -useb https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe -OutFile tailscale-setup.exe
          Write-Host "‚öôÔ∏è Installation shuru hai..."
          start-process -FilePath .\tailscale-setup.exe -ArgumentList "/quiet", "/norestart" -Wait
          Write-Host "‚úÖ Tailscale Install ho gaya."

      - name: Tailscale Connect (Using Your Key)
        shell: powershell
        run: |
          Write-Host "üì° Tailscale Network se connect ho raha hai..."
          # Aapki key yahan use ho rahi hai
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey=tskey-auth-kF29Zucb5721CNTRL-Hjf7uGto6FLiKjgmKve3FLiKeMfUjnku --accept-dns=false --hostname=GitHub-RDP
          Write-Host "‚úÖ Connection Successful!"

      - name: Enable Remote Desktop & Fix Connection
        shell: powershell
        run: |
          Write-Host "üõ†Ô∏è Windows settings optimize ho rahi hain..."
          # RDP allow karna
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          # Password set karna (User: runneradmin | Pass: RDP123456)
          $Password = ConvertTo-SecureString "RDP123456" -AsPlainText -Force
          Set-LocalUser -Name "runneradmin" -Password $Password
          Write-Host "‚úÖ User: runneradmin | Password: RDP123456"

      - name: Keep RDP Alive (No Disconnect)
        shell: powershell
        run: |
          Write-Host "üî• RDP Active hai. Ab Tailscale Dashboard mein 'GitHub-RDP' ka IP check karen."
          $i = 0
          while($i -lt 360) {
            $time = Get-Date -Format "HH:mm:ss"
            Write-Host "[$time] Status: Online & Stable..."
            Start-Sleep -Seconds 60
            $i++
          }
