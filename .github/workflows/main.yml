name: TITAN-V175-NO-ERROR-EDITION

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1. Fix User & Services
        shell: powershell
        run: |
          $Password = ConvertTo-SecureString "Admin@Watch786" -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $Password -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }
          # Disabling heavy background tasks to save CPU
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force

      - name: 2. Modern Virtual RAM Fix (No WMIC)
        shell: powershell
        run: |
          # Memory management optimization
          $pagefile = Get-CimInstance Win32_PageFileSetting
          Set-CimInstance -Query "Select * from Win32_PageFileSetting" -Property @{InitialSize = 32768; MaximumSize = 65536} -ErrorAction SilentlyContinue
          pip install pyautogui psutil --quiet

      - name: 3. Tailscale Link (Login Here)
        shell: powershell
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          Write-Host "`n******************************************************"
          Write-Host ">>> OPEN THIS LINK: <<<"
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --accept-dns=false --force-reauth
          Write-Host "******************************************************`n"
          Start-Sleep -Seconds 120

      - name: 4. Deploy Anti-Crash Watcher
        run: |
          $script = @"
          import os, time, subprocess, threading, pyautogui, random, psutil
          def human_bot():
              while True:
                  # Randomly move mouse and press keys to fool GitHub/YT
                  time.sleep(random.randint(20, 55))
                  pyautogui.press('f15') # Invisible key
                  pyautogui.moveRel(random.randint(-1, 1), 0)

          def launch():
              ff = r'C:\Program Files\Mozilla Firefox\firefox.exe'
              for i in range(35): # 35 is safer than 40 for stability
                  p = f'C:\\Users\\Public\\T_{i}'
                  if not os.path.exists(p): os.makedirs(p)
                  # Internal Firefox Hardening
                  with open(os.path.join(p, "prefs.js"), "w") as f:
                      f.write('user_pref("network.proxy.type", 1);\n')
                      f.write('user_pref("network.proxy.http", "45.152.188.238");\n')
                      f.write('user_pref("network.proxy.http_port", 3128);\n')
                      f.write('user_pref("network.proxy.ssl", "45.152.188.238");\n')
                      f.write('user_pref("network.proxy.ssl_port", 3128);\n')
                      f.write('user_pref("media.volume_scale", "0.0");\n')
                      f.write('user_pref("browser.tabs.remote.autostart", false);\n') # Saves RAM
                  
                  subprocess.Popen([ff, "-new-instance", "-profile", p, "-no-remote", "http://googleusercontent.com/youtube.com/watch?v=YOUR_VIDEO_ID"])
                  time.sleep(12)

          if __name__ == "__main__":
              threading.Thread(target=human_bot, daemon=True).start()
              launch()
          "@
          $script | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_FINAL.py" -Encoding ascii
          "@echo off`npython C:\Users\Public\Desktop\TITAN_FINAL.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START.bat" -Encoding ascii

      - name: 5. Keep-Alive (9 Hours)
        run: Start-Sleep -Seconds 32400
