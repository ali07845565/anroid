name: TITAN-V218-FINAL-STABLE

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1. Setup User & Mobile View
        shell: powershell
        run: |
          # Agar user ya service pehle se bani ho toh ye ignore karega
          $Password = ConvertTo-SecureString "Admin@Watch786" -AsPlainText -Force
          net user RDP Admin@Watch786 /add /expires:never 2>$null
          net localgroup Administrators RDP /add 2>$null
          
          # Mobile Friendly Screen
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "DefaultDestinationHeight" -Value 600
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "DefaultDestinationWidth" -Value 800
          
          # Audio Service ignore error if already started
          $service = Get-Service audiosrv
          if ($service.Status -ne 'Running') { Start-Service audiosrv }
          exit 0

      - name: 2. Install Chrome & Tools
        shell: powershell
        run: |
          choco install googlechrome cloudflared python -y --no-progress
          pip install pyautogui requests --quiet
          exit 0

      - name: 3. Setup BAS & Epic Bot (Free Versions)
        shell: powershell
        run: |
          # Downloading Free Tools to Desktop
          Invoke-WebRequest -Uri "https://cdn.epicbot.com/EpicBotSetup.exe" -OutFile "C:\Users\Public\Desktop\EpicBot_Free.exe" -ErrorAction SilentlyContinue
          # Proxy list generator
          $proxyPy = "import requests`ntry:`n r = requests.get('https://api.proxyscrape.com/v2/?request=displayproxies&protocol=http')`n with open('C:\\Users\\Public\\Desktop\\Proxies.txt', 'w') as f: f.write(r.text)`nexcept: pass"
          python -c "$proxyPy"
          exit 0

      - name: 4. Generate Direct Mobile Link
        shell: powershell
        run: |
          Write-Host "--- SYSTEM STARTING... PLEASE WAIT ---" -ForegroundColor Cyan
          Start-Process cloudflared -ArgumentList "tunnel --url rdp://localhost:3389" -RedirectStandardOutput "C:\Users\Public\Desktop\address.log"
          Start-Sleep -Seconds 45
          $address = Get-Content "C:\Users\Public\Desktop\address.log" | Select-String "trycloudflare.com"
          Write-Host "--------------------------------------------------"
          Write-Host "LINK: $address" -ForegroundColor Green
          Write-Host "USER: RDP | PASS: Admin@Watch786" -ForegroundColor Yellow
          Write-Host "--------------------------------------------------"
          exit 0

      - name: 5. Stay Alive 9 Hours
        run: Start-Sleep -Seconds 32400
