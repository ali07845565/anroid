name: TITAN-V180-WARP-AI-STABLE

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1. Speed Up & Warp Install
        shell: powershell
        run: |
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          # Installing Cloudflare Warp & Requirements
          choco install cloudflare-warp -y
          pip install pyautogui psutil --quiet
          winget install --id Mozilla.Firefox -e --silent --accept-source-agreements

      - name: 2. Tailscale Login
        shell: powershell
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --accept-dns=false --force-reauth
          Start-Sleep -Seconds 120

      - name: 3. Activate Cloudflare Warp (System-Wide IP)
        shell: powershell
        run: |
          & "C:\Program Files\Cloudflare\Cloudflare WARP\warp-cli.exe" --accept-tos registration register
          & "C:\Program Files\Cloudflare\Cloudflare WARP\warp-cli.exe" --accept-tos mode warp
          & "C:\Program Files\Cloudflare\Cloudflare WARP\warp-cli.exe" --accept-tos connect
          Write-Host "Cloudflare WARP is Active!" -ForegroundColor Cyan

      - name: 4. Deploy AI-Integrated Multi-Video Bot
        run: |
          $script = @"
          import os, time, subprocess, threading, pyautogui, random, psutil

          VIDEO_LINKS = [
              "https://youtu.be/oiyYa3IL2Rc?si=LnzHB2SnxLvotRp-",
              "https://youtu.be/OXuTuHQqB7s?si=hsLjg-WN4Kddl2en",
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G0",
              "https://youtu.be/z25lo2mogbk?si=RDQn25eKVGl6u8Dy",
              "https://youtu.be/ZkJlQ_q7x5Q?si=5vafU9AuYNTZcp5E"
          ]

          # --- AI INTEGRATED MOVEMENT (ANTI-BOT) ---
          def ai_movement():
              print("AI Movement Bot Started...")
              while True:
                  t = random.randint(15, 45)
                  time.sleep(t)
                  choice = random.choice(['move', 'scroll', 'key'])
                  if choice == 'move':
                      pyautogui.moveRel(random.randint(-10, 10), random.randint(-10, 10))
                  elif choice == 'scroll':
                      pyautogui.scroll(random.randint(-200, 200))
                  else:
                      pyautogui.press('f15')

          def launch():
              ff = r'C:\Program Files\Mozilla Firefox\firefox.exe'
              tab_count = 0
              for link in VIDEO_LINKS:
                  for repeat in range(3): # 15 Total Tabs
                      tab_count += 1
                      p = f'C:\\Users\\Public\\P_{tab_count}'
                      if not os.path.exists(p): os.makedirs(p)
                      
                      with open(os.path.join(p, "prefs.js"), "w") as f:
                          f.write('user_pref("media.volume_scale", "0.0");\n')
                          f.write('user_pref("permissions.default.image", 2);\n')
                          # --- FORCE 144P & PERFORMANCE ---
                          f.write('user_pref("media.autoplay.default", 0);\n')
                          f.write('user_pref("dom.ipc.plugins.enabled.libflashplayer.so", "false");\n')
                          f.write('user_pref("browser.sessionstore.resume_from_crash", false);\n')

                      # Append loop command to URL if possible or handle via browser
                      subprocess.Popen([ff, "-new-instance", "-profile", p, "-no-remote", link])
                      print(f"Tab {tab_count} launched via Warp.")
                      time.sleep(12)

          if __name__ == "__main__":
              threading.Thread(target=ai_movement, daemon=True).start()
              launch()
          "@
          $script | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_AI.py" -Encoding ascii
          "@echo off`npython C:\Users\Public\Desktop\TITAN_AI.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START.bat" -Encoding ascii

      - name: 5. Keep-Alive
        run: Start-Sleep -Seconds 32400
